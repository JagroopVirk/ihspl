---
const url = new URL(Astro.request.url);
const success = url.searchParams.get("success");
const error = url.searchParams.get("error");

let alert = { type: '', text: '' };

if (success === "true") {
  alert = { type: 'success', text: "‚úÖ Thank you for contacting us. We will get back to you soon." };
} else if (error === "empty") {
  alert = { type: 'error', text: "‚ö†Ô∏è Please fill in all required fields." };
} else if (error === "invalid_email") {
  alert = { type: 'error', text: "‚ö†Ô∏è Invalid email format." };
} else if (error === "send_failed") {
  alert = { type: 'error', text: "‚ùå Sorry, there was an error sending your message." };
} else if (error === "spam_detected") {
  alert = { type: 'error', text: "üö´ Spam detected. Please try again later." };
} else if (error === "too_many_attempts") {
  alert = { type: 'error', text: "üö´ Too many submissions. Please wait and try again later." };
} else if (error === "invalid_request") {
  alert = { type: 'error', text: "‚ùå Invalid request." };
}
---

<div class="formDiv w-full md:w-1/2 pxy-8 flex flex-col justify-center">
   
{/* Alert Message  */}
{alert.text && (
  <div
    id="form-alert"
    class={`p-4 my-4 rounded-md text-sm ${
      alert.type === 'success'
        ? 'bg-green-100 text-green-800 border border-green-300'
        : 'bg-red-100 text-red-800 border border-red-300'
    }`} 
    
  >
    {/* // TODO: use color variables */}
    {alert.text}
  </div>
)}
{/* Form */}
<h2 class="text-center mb-6">Have a Question? <span class="halfHeading">Let‚Äôs Talk</span></h2>
    <form 
    id="contactForm"
      action="../sendmail.php" 
      method="POST"
      class="flex flex-col gap-4"
    >
      <div class="mb-4">
        <label for="name" class="block mb-1">Name<span class="text-red-500">*</span></label>
        <input type="text" id="name" name="name" placeholder="Full Name" required class="w-full border p-2 rounded-md focus:outline-none focus:ring-1 focus:ring-input-focus" />
      </div>
      
      <div class="mb-4">
        <label for="email" class="block mb-1">Email<span class="text-red-500">*</span></label>
        <input type="email" id="email" name="email" placeholder="Yours email address" required class="w-full border p-2 rounded-md focus:outline-none focus:ring-1 focus:ring-input-focus" />
      </div>
      
      <div class="mb-4">
        <label for="contact" class="block mb-1">Contact</label>
        <input type="text" id="contact" name="contact" placeholder="Your contact number" class="w-full border p-2 rounded-md focus:outline-none focus:ring-1 focus:ring-input-focus" />
      </div>
      
      <div class="mb-4">
        <label for="message" class="block mb-1">Message<span class="text-red-500">*</span></label>
        <textarea id="message" name="message" placeholder="Write full query" required class="w-full border p-2 rounded-md h-32 focus:outline-none focus:ring-1 focus:ring-input-focus "></textarea>
      </div>

      <div class="mb-4" style="display:none">
        <label for="website" class="block mb-1">Website</label>
        <input type="text" id="website" name="website" placeholder="website" class="border" />
      </div>

      <button type="submit" class="button">Send Message</button>
    </form>
  </div>

 {/* to hide the alert box  */}
  <script>
  setTimeout(() => { 
    const alertBox = document.getElementById("form-alert");
    if (alertBox) {
      alertBox.style.display = "none";
    }
  }, 5000);
</script>


<style>
{/* Text & color styling  */}
@reference "tailwindcss";

h2 {
  @apply tracking-wider;
  color: var(--color-black);
}

label {
  @apply text-base font-medium;
  color: var(--color-gray);
}

input, textarea {
  @apply text-base;
  color: var(--color-gray);
  border-color: var(--color-input-border);
}
</style>