---
import '@/styles/global.css';

import favIcon from '@/assets/favicon.png';

import GoogleFonts from '@/components/extras/GoogleFonts.astro';
import GoogleTag from '@/components/extras/GoogleTag.astro';
import Seo from '@/components/seo/Seo.astro';
import GtmPush from '@/components/extras/GtmPush.astro';

import defaultSeo from '@/data/js/seo/index.js';
import { locationSchema } from '@/data/js/seo/locationSchema.js';

import Header from '@/components/header/Header.astro';
import Footer from '@/components/footer/Footer.astro';

const { meta, faqSchema, pageLink } = defaultSeo;

const {
  seo = {
    title: `${meta.title} - Indivirtus`,
    description: meta.description,
    keywords: meta.keywords,
    canonical: meta.canonicalUrl,
    url: pageLink,
    schema: null,
    faqSchema: faqSchema,
    ogTags: meta.ogTags,
    twitterCard: meta.twitterCard,
  },
  location = locationSchema,
  gtm = null,
} = Astro.props;

const gtmProps = gtm
  ? {
      event: gtm.eventAction,
      eventCategory: gtm.eventCategory,
      eventLabel: gtm.eventLabel,
      serviceTier: gtm.dataLayerPush?.reportType?.join(', ') ?? '',
      regulatoryLevel: Array.isArray(gtm.dataLayerPush?.certification)
        ? gtm.dataLayerPush.certification.join(', ')
        : (gtm.dataLayerPush?.certification ?? ''),
    }
  : null;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png+xml" href={favIcon.src} />

    <GoogleFonts />
    <Seo {...seo} locationSchema={location} />
    <GoogleTag />
    {gtmProps && <GtmPush {...gtmProps} />}
  </head>

  <body>
    <Header />

    <main>
      <slot />
    </main>

    <Footer />

    {/* gsap import */}
    <script type="module" src="/scripts/gsap-init.js"></script>
  </body>
</html>
